Services-Properties:
  labels:
    io.rancher.scheduler.affinity:host_label: stackType=urs
    io.rancher.container.pull_image: always
    service_name: ServicesProperties
    project.service.name: services-properties
    project.name: cis-urs
    project.stack: urs
    io.rancher.container.hostname_override: container_name
    io.rancher.scheduler.affinity:container_label_soft_ne: io.rancher.stack_service.name=$${stack_name}/$${service_name}
    environment_name: ${env_shortcode}
    service_name: $${service_name}
  image: ${registry_url}/urs-httpd:${urs_version}
  tty: true
  stdin_open: true
  environment:
    ENV_SHORTCODE: ${env_shortcode}
    SPINE_EXTERNAL_SHORTCODE: ${spine_external_shortcode}
    SESSION_MANAGER_SERVICE_URL: LB-AuthBusinessService.auth-local.rancher.internal:8080/sessionmanager/session
    SESSION_SERVICE_URL: LB-AuthBusinessService.auth-local.rancher.internal:8080/amserver/sessionservice
    SAML_SERVICE_URL: LB-AuthBusinessService.auth-local.rancher.internal:8080/saml/RoleAssertion?token=
    AUTHENTICATOR_ROLE_SELECTION_URL: LB-AuthBusinessService.auth-local.rancher.internal:8080/authenticator/RoleSelectionGP.jsp
    CMS_SOPINRANDOMVALUE: ${cms_sopinrandomvalue}
    CMS_CA1_MANAGER_PORT: 1829
    CMS_CA2_MANAGER_PORT: 2829
    CMS_CA3_MANAGER_PORT: 1829
    CMS_CLIENTDLL_UPDATEDATE: ${cms_clientdll_updatedate}
    CMS_OT_SMARTCARD_DLL_MIN_VERSION: ${cms_ot_smartcard_dll_min_version}
    CMS_OT_SMARTCARD_DLL_CURRENT_VERSION: ${cms_ot_smartcard_dll_current_version}
    INTENG_NOTIFICATION_SERVICE_ENDPOINTADDRESS: LB-BusinessServices:8080/cxf/esrNotification
    INTENG_NOTIFICATION_SCHEDULAR_ENDPOINTADDRESS: LB-BusinessServices:8080/cxf/esrNotification
    OSCAR_ORIGINATOR1: oscar-lh.npfit.nhs.uk
    OSCAR_ORIGINATOR2: 
    MOBILE_AUTHENTICATION: ${mobile_authentication}
    MOBILE_ROLESELECTION: ${mobile_roleselection}
    MOBILE_ORGANISATION_ALLOWED: Y51
    EMAIL_SERVICE_USERNAME: noreply@nhs.net
    EMAIL_SERVICE_PASSWORD: Password1
    EMAIL_FROM_ADDRESS: noreply@nhs.net
    EMAIL_SERVICE_MODE_TYPE: LOG
    SPINE_SELFSERVICE_ORGANISATION_ALLOWED: Y51
    ENTRUST_AUTHCA_XAP_PORT: 1443
    ENTRUST_CCCA_XAP_PORT: 2443
    FEATURE_IAM_EPR_XML_API_ENABLED: ${feature_iam_epr_xml_api_enabled}
    FEATURE_IAM_LAST_LOGIN_DISPLAY_ENABLED: False
    FEATURE_IAM_MOBILE_DEVICE_PROVISION_ENABLED: True
    FEATURE_IAM_SELFSERVICE_ENABLED: False
    FEATURE_USERCLOSUREBATCH_SERVICE_ENABLED: True
    FEATURE_CIS_ASSIGNUSERPOSITIONS_TRANSACTION_ROLLBACK: True
    FEATURE_CAREID_SMARTCARDAPPLET_OT_REPAIR_RENEW_ENABLED: False
    FEATURE_CIS_DESTROYSMARTCARDS_TO_REMOTECANCELLED: True
    FEATURE_CIS_ASSIGNUSERPOSITIONSVALIDATION_ENABLED: True

IAM-Database:
  image: rancher/external-service
  labels:
    project.service.name: iam-database
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs

Directory:
    image: rancher/lb-service-haproxy:v0.4.9
    expose:
    - 389:389/tcp
    labels:
      io.rancher.container.agent.role: environmentAdmin
      io.rancher.container.create_agent: 'true'
      project.service.name: directory
      project.name: cis-urs
      project.stack: urs
      io.rancher.scheduler.affinity:host_label_soft: stacktype=urs

Entrust-CA1-Manager:
  image: rancher/external-service
  labels:
    project.service.name: entrust-ca1-manager
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs

Entrust-CA2-Manager:
  image: rancher/external-service
  labels:
    project.service.name: entrust-ca2-manager
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs

Entrust-CA3-Manager:
  image: rancher/external-service
  labels:
    project.service.name: entrust-ca3-manager
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs

Outbound-Messaging-Service:
  image: rancher/external-service
  labels:
    project.service.name: outbound-messaging-service
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs

WebSessionStore:
  image: rancher/external-service
  labels:
    project.service.name: web-sessionstore
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs

RedisSessionStore:
  image: rancher/external-service
  labels:
    project.service.name: redis-sessionstore
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs

Audit:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: Audit
    project.service.name: audit
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-audit:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms60m -Xms150m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

GuvnorService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: GuvnorService
    project.service.name: guvnor-service
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-guvnor:${urs_version}
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

CMS-BusinessService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: CMS-BusinessService
    project.service.name: cms-businessservice
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  privileged: true
  environment:
    GLUSTER_URL: ${gluster_url}
    GLUSTER_FOLDER: ${env_shortcode}
    ENTRUST_AUTHCA_CA_PORT: 1829
    ENTRUST_AUTHCA_MANAGER_PORT: 1709
    ENTRUST_AUTHCA_ASH_PORT: 1710
    ENTRUST_AUTHCA_XAP_PORT: 1443
    ENTRUST_AUTHCA_SEARCH_BASE: CN=DOCKER_SUBCA,ou=CA,o=nhs
    ENTRUST_CCCA_CA_PORT: 2829
    ENTRUST_CCCA_MANAGER_PORT: 2709
    ENTRUST_CCCA_ASH_PORT: 2710
    ENTRUST_CCCA_XAP_PORT: 2443
    ENTRUST_CCCA_SEARCH_BASE: DOCKER_SUBCC,ou=CA,o=nhs
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  image: ${registry_url}/cis-cms-business:${urs_version}
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database
  - Directory:Directory
  - Entrust-CA1-Manager:Entrust-CA1-Manager
  - Entrust-CA2-Manager:Entrust-CA2-Manager
  - Entrust-CA3-Manager:Entrust-CA3-Manager

EPR-BusinessService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: EPR-BusinessService
    project.service.name: epr-businessservice
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-epr-business:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

UID-Service:
  image: ${registry_url}/cis-urs-uid:${urs_version}
  tty: true
  stdin_open: true
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: UID-Service
    project.service.name: uid-service
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  volumes:
  - /var/log/iam:/var/log/iam
  links:
  - IAM-Database:IAM-Database

URS-BusinessService:
  image: ${registry_url}/cis-urs-business:${urs_version}
  tty: true
  stdin_open: true
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: URS-BusinessService
    project.service.name: urs-businessservice
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  - /home/rancher/env_config/${env_shortcode}/secaudit/client:/home/iam_user/secaudcertificates/client
  privileged: true
  environment:
    GLUSTER_URL: ${gluster_url}
    GLUSTER_FOLDER: ${env_shortcode}
    GLUSTER_PHOTOS: 'true'
    GLUSTER_REPORTS: 'true'
  links:
  - IAM-Database:IAM-Database
  - LB-Secure:LB-Secure

Integration:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: Integration
    project.service.name: integration
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-integration:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

OMS-BusinessService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: OMS-BusinessService
    project.service.name: oms-businessservice
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-oms-business:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database
  - LB-Secure:LB-Secure

OSCAR-BusinessService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: OSCAR-BusinessService
    project.service.name: oscar-businessservice
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-oscar-business:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

RulesService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: RulesService
    project.service.name: rules-service
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-rules:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

SecureAudit:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: SecureAudit
    project.service.name: secure-audit
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  - /home/rancher/env_config/${env_shortcode}/secaudit/server:/home/iam_user/secaudcertificates/server
  image: ${registry_url}/cis-secureaudit:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

Scheduler:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: Scheduler
    project.service.name: scheduler
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  - /home/rancher/env_config/${env_shortcode}/quartz.properties:/home/iam_user/careidconfig/quartz.properties
  image: ${registry_url}/cis-scheduler:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

ID-StoreSyncService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: ID-StoreSyncService
    project.service.name: id-store-sync-service
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-id-storesync:${urs_version}
  tty: true
  stdin_open: true
  environment:
    OPENIDM_OPTS: -Xmx2048m -Xms512m -Dfile.encoding=UTF-8
    OPENIDM_PORT: '389'
  links:
  - IAM-Database:IAM-Database
  - Directory:Directory

CC-CheckerService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: CC-CheckerService
    project.service.name: cc-checker-service
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  image: ${registry_url}/cis-ccc:${urs_version}
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database
  - Directory:Directory

ReportingService:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: ReportingService
    project.service.name: reporting-service
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-reporting:${urs_version}
  tty: true
  stdin_open: true
  privileged: true
  environment:
    GLUSTER_URL: ${gluster_url}
    GLUSTER_FOLDER: ${env_shortcode}
    GLUSTER_REPORTS: 'true'
    JAVA_OPTS: -server -Xms256m -Xmx512m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  links:
  - IAM-Database:IAM-Database

SCEP:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: SCEP
    project.service.name: scep
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  environment:
    CMS_SERVICE_URL: http://LB-BusinessServices:8080/cmsbusservice/rest/cms/
    PKI_URL: https://wfe.${env_shortcode}.iam.spine2.ncrs.nhs.uk/scep/pkiclient.exe
    RETURN_URL: https://wfe.${env_shortcode}.iam.spine2.ncrs.nhs.uk/scep/
  tty: true
  image: ${registry_url}/cis-scep:${urs_version}
  stdin_open: true
  links:
  - IAM-Database:IAM-Database

EPR-WebFrontEnd:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: EPR-WebFrontEnd
    project.service.name: epr-webfrontend
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-epr-webfrontend:${urs_version}
  environment:
    JAVA_OPTS: -server -Xms128m -Xms256m -XX:NewSize=128m -XX:MaxNewSize=256m -XX:PermSize=64m -XX:MaxPermSize=128m -XX:+UseConcMarkSweepGC  -XX:+UseParNewGC   -XX:ParallelGCThreads=2 -Djava.security.egd=file:/dev/./urandom
  tty: true
  stdin_open: true
  links:
  - IAM-Database:IAM-Database
  - WebSessionStore:RedisSessionStore

URS-WebFrontEnd:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: URS-WebFrontEnd
    io.rancher.container.dns: true
    project.service.name: urs-webfrontend
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-urs-webfrontend:${urs_version}
  tty: true
  stdin_open: true
  privileged: true
  environment:
    GLUSTER_URL: ${gluster_url}
    GLUSTER_FOLDER: ${env_shortcode}
    GLUSTER_PHOTOS: true
    GLUSTER_REPORTS: true
    JAVA_OPTS: -server -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:ParallelGCThreads=2 -Xms512m -Xmx1500m
  links:
  - IAM-Database:IAM-Database
  - WebSessionStore:RedisSessionStore

Portal:
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: Portal
    io.rancher.container.dns: true
    project.service.name: portal
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  image: ${registry_url}/cis-portal:${urs_version}
  tty: true
  stdin_open: true
  privileged: true
  environment:
    GLUSTER_URL: ${gluster_url}
    GLUSTER_FOLDER: ${env_shortcode}
    GLUSTER_PHOTOS: true
    GLUSTER_REPORTS: true
    JAVA_OPTS: -server -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:ParallelGCThreads=2 -Xms512m -Xmx1500m
  links:
  - WebSessionStore:RedisSessionStore

haproxy-fe:
  net: "host"
  labels:
    io.rancher.scheduler.global: 'true'
    io.rancher.container.hostname_override: container_name
    io.rancher.container.dns: true
    environment_name: ${env_shortcode}
    service_name: haproxy-fe
    project.service.name: haproxy-fe
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label: stacktype=urs
  volumes:
  - /home/rancher:/mnt/gluster
  links:
  - URS-WebFrontEnd:URS-WebFrontEnd
  - EPR-WebFrontEnd:EPR-WebFrontEnd
  - Integration:Integration
  - Portal:Portal
  - SelfService-WebFrontEnd:SelfService-WebFrontEnd
  environment:
    - fe1ip=0.0.0.0
    - fe2ip=$VIP_TWO
    - fe3ip=$VIP_THREE
    - fe4ip=$VIP_FOUR
    - fe1pemfile=wfe.lh.iam.spine2.ncrs.nhs.uk
    - fe2pemfile=$VIP_TWO_PEM
    - fe3pemfile=$VIP_THREE_PEM
    - fe4pemfile=$VIP_FOUR_PEM
    - be1-1fqdn=urs-webfrontend.urs-local.rancher.internal
    - be1-2fqdn=epr-webfrontend.urs-local.rancher.internal
    - be1-3fqdn=portal.urs-local.rancher.internal
    - be1-4fqdn=integration.urs-local.rancher.internal
    - be1-5fqdn=
    - be2fqdn=$VIP_TWO_BE
    - be3fqdn=$VIP_THREE_BE
    - be4fqdn=$VIP_FOUR_BE
    - GLUSTER_URL=${gluster_url}
    - envcode=${env_shortcode}
  image: ${registry_url}/cis-fe-haproxy
  tty: true
  stdin_open: true
  privileged: true

SelfService-WebFrontEnd:
  environment:
    GLUSTER_URL: ${gluster_url}
    GLUSTER_FOLDER: ${env_shortcode}
    GLUSTER_PHOTOS: true
    GLUSTER_REPORTS: true
    JAVA_OPTS: -server -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:ParallelGCThreads=2 -Xms512m -Xmx1500m
  labels:
    environment_name: lh
    io.rancher.container.hostname_override: container_name
    service_name: SelfService-WebFrontEnd
    project.service.name: selfservice-webfrontend
    project.name: cis-urs
    project.stack: urs
    io.rancher.container.dns: 'true'
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  links:
    - WebSessionStore:RedisSessionStore
  tty: true
  log_opt: {}
  image: ${registry_url}/cis-selfservice-webfrontend:latest
  privileged: true
  volumes:
  - /var/log/iam:/var/log/iam
  stdin_open: true

EmailService:
  image: ${registry_url}/cis-emailservice:${urs_version}
  tty: true
  stdin_open: true
  labels:
    io.rancher.container.hostname_override: container_name
    environment_name: ${env_shortcode}
    service_name: EmailService
    project.service.name: emailservice
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  volumes:
  - /var/log/iam:/var/log/iam
  privileged: true

LB-BusinessServices:
  expose:
  - 8080:8080
  ports:
  - 8080:8080
  labels:
    io.rancher.loadbalancer.target.URS-BusinessService: 8080/ursbusservice=8080
    io.rancher.loadbalancer.target.EPR-WebFrontEnd: 8080/eprwebapp=8080
    io.rancher.loadbalancer.target.Portal: 8080/portal=8080
    io.rancher.loadbalancer.target.OSCAR-BusinessService: 8080/orsservice=8080
    io.rancher.loadbalancer.target.Integration: 8080/cxf=8181
    io.rancher.loadbalancer.target.ReportingService: 8080/iamrepservice=8080
    io.rancher.loadbalancer.target.Audit: 8080/auditloggerws=8080
    io.rancher.loadbalancer.target.SCEP: 8080/mobileconfig=9098
    io.rancher.loadbalancer.target.UID-Service: 8080/uidservice=8080
    io.rancher.loadbalancer.target.GuvnorService: 8080/guvnor-5.5.0.Final-tomcat-6.0=8080
    io.rancher.loadbalancer.target.OMS-BusinessService: 8080/omsbusservice=8080
    io.rancher.loadbalancer.target.ID-StoreSyncService: 8080/idstoresyncmanager=8080,8080/openidm=8081
    io.rancher.loadbalancer.target.CC-CheckerService: 8080/cccheckerservice/8080
    io.rancher.loadbalancer.target.Outbound-Messaging-Service: 8080/esrNotification=8080,8080/eprNotification=8080,8080/AckRecord=8104
    io.rancher.loadbalancer.target.URS-WebFrontEnd: 8080/urswebapp=8080
    io.rancher.loadbalancer.target.EPR-BusinessService: 8080/eprbusservice=8080
    io.rancher.loadbalancer.target.RulesService: 8080/rulesservice=8080
    io.rancher.loadbalancer.target.CMS-BusinessService: 8080/cmsbusservice=8080
    io.rancher.loadbalancer.target.EmailService: 8080/emailservice=8080
    environment_name: ${env_shortcode}
    service_name: LB-BusinessServices
    project.service.name: lb-businessservices
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  tty: true
  image: rancher/load-balancer-service
  links:
  - UID-Service:UID-Service
  - OSCAR-BusinessService:OSCAR-BusinessService
  - EPR-BusinessService:EPR-BusinessService
  - RulesService:RulesService
  - SCEP:SCEP
  - ID-StoreSyncService:ID-StoreSyncService
  - CC-CheckerService:CC-CheckerService
  - ReportingService:ReportingService
  - Outbound-Messaging-Service:Outbound-Messaging-Service
  - Integration:Integration
  - GuvnorService:GuvnorService
  - CMS-BusinessService:CMS-BusinessService
  - Audit:Audit
  - EPR-WebFrontEnd:EPR-WebFrontEnd
  - OMS-BusinessService:OMS-BusinessService
  - URS-BusinessService:URS-BusinessService
  - Portal:Portal
  - EmailService:EmailService
  stdin_open: true

LB-Secure:
  expose:
  - 8443:8443/tcp
  labels:
    environment_name: ${env_shortcode}
    service_name: LB-Secure
    project.service.name: lb-secure
    project.name: cis-urs
    project.stack: urs
    io.rancher.scheduler.affinity:host_label_soft: stacktype=urs
  image: rancher/load-balancer-service
  tty: true
  stdin_open: true
  links:
  - SecureAudit:SecureAudit